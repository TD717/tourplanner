@startuml Full-Text Search Sequence Diagram

actor User
participant "TourListView" as View
participant "TourListViewModel" as ViewModel
participant "TourService" as Service
participant "TourRepository" as Repository
database "H2 Database" as DB

User -> View: Type "mountain" in search field
activate View

View -> View: TextField listener triggered
View -> ViewModel: searchTours("mountain")
activate ViewModel

ViewModel -> ViewModel: setLoading(true)
ViewModel -> ViewModel: clearError()

ViewModel -> Service: searchTours("mountain")
activate Service

Service -> Service: Validate search text
Service -> Service: Trim and check if empty

alt searchText is not empty
    Service -> Repository: findByNameContainingIgnoreCase("mountain")
    activate Repository
    
    Repository -> DB: SELECT * FROM tours WHERE LOWER(name) LIKE '%mountain%'
    activate DB
    DB --> Repository: Return matching tours
    deactivate DB
    
    Repository --> Service: List<Tour> results
    deactivate Repository
    
    Service -> Service: Convert entities to DTOs
    Service -> Service: map(this::convertToDTO)
    
else searchText is empty
    Service -> Repository: findAll()
    activate Repository
    Repository -> DB: SELECT * FROM tours
    activate DB
    DB --> Repository: All tours
    deactivate DB
    Repository --> Service: List<Tour> all tours
    deactivate Repository
    
    Service -> Service: Convert entities to DTOs
end

Service --> ViewModel: List<TourDTO> results
deactivate Service

ViewModel -> ViewModel: Clear existing tours list
ViewModel -> ViewModel: Add all search results to tours list
ViewModel -> ViewModel: setLoading(false)

ViewModel --> View: Update completed
deactivate ViewModel

View -> View: Update ListView with new data
View -> View: Refresh UI display

View --> User: Display filtered tour list
deactivate View

note over User, DB
    The search is case-insensitive and uses
    SQL LIKE operator with wildcards.
    Results are automatically updated in the UI
    through JavaFX property binding.
end note

@enduml 